@using SWNBlazorApp.Data
@using SWNUniverseGenerator.Models
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage

@inject ProtectedSessionStorage ProtectedSessionStore
@inject UniverseService UniverseService
@inject Universe CurrentUniverse
@inject IMenuService MenuService


<MudDrawer Open="true" Anchor="Anchor.Start" Width="250px" Class="py-3 mud-height-full" Elevation="0" Variant="DrawerVariant.Persistent">
    <MudNavMenu Bordered="true" Class="mud-width-full">
        <MudText Typo="Typo.h6" Class="px-4">Nav Menu</MudText>
        @if(CurrentUniverse.Name != "" || !string.IsNullOrEmpty(CurrentUniverse.Name))
        {
            <MudText Typo="Typo.body2" Class="px-4 mud-text-secondary">@CurrentUniverse.Name</MudText>
        }
        <MudDivider Class="my-2"/>
        <MudNavLink Href="/universes" Icon="@Icons.Material.Filled.Workspaces">Universes</MudNavLink>
        @if (CurrentUniverse.Name != "" || !string.IsNullOrEmpty(CurrentUniverse.Name))
        {
            <MudNavGroup Title="@CurrentUniverse.Name" Icon="@Icons.Material.Filled.BlurCircular">
                <MudNavLink Href="/universe" Icon="@Icons.Material.Filled.Map">Star Map</MudNavLink>
                <MudNavLink Href="/stars" Icon="@Icons.Material.Filled.BrightnessHigh">Star List</MudNavLink>
                <MudNavLink Href="/characters" Icon="@Icons.Material.Filled.People">Character List</MudNavLink>
                <MudNavLink Href="/ships" Icon="@Icons.Material.Filled.Rocket">Ship List</MudNavLink>
            </MudNavGroup>
        }
    </MudNavMenu>
</MudDrawer>

@code {
    private bool collapseNavMenu = true;
    private bool open = true;

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        var universeId = await ProtectedSessionStore.GetAsync<string>("SelectedUniverse");
        if (!string.IsNullOrEmpty(universeId.Value))
        {
            Task<Universe> task = UniverseService.GetUniverseAsync(universeId.Value);
            CurrentUniverse = UniverseService.GetUniverseAsync(universeId.Value).Result;
        }
    }

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private async Task MenuChanged(EventArgs e)
    {
        await InvokeAsync(StateHasChanged);
        await OnAfterRenderAsync(true);
    }

}